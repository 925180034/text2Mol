# 多模态分子生成系统评估报告

**生成时间**: 2025-08-09 14:35  
**模型路径**: `/root/autodl-tmp/text2Mol-outputs/optimized_20250809_105726/best_model.pt`  
**测试样本数**: 100  

## 📊 评估概览

### 9种输入输出组合测试结果

| 输入模态 | 输出模态 | 状态 | 备注 |
|---------|---------|------|------|
| SMILES | SMILES | ✅ 成功 | 有效性仅4.35% |
| Graph | SMILES | ❌ 失败 | 图编码器错误 |
| Image | SMILES | ❌ 失败 | 图像编码器错误 |
| SMILES | Graph | 🔄 未实现 | 需要Graph解码器 |
| SMILES | Image | 🔄 未实现 | 需要Image解码器 |
| Graph | Graph | 🔄 未实现 | 需要Graph解码器 |
| Graph | Image | 🔄 未实现 | 需要Image解码器 |
| Image | Graph | 🔄 未实现 | 需要Graph解码器 |
| Image | Image | 🔄 未实现 | 需要Image解码器 |

**总结**: 9种组合中仅1种成功测试，2种失败，6种未实现

## 📈 10种评估指标结果

### SMILES→SMILES组合的指标 (唯一成功的组合)

| 指标名称 | 分值 | 百分比 | 评价 |
|---------|------|--------|------|
| 1. 有效性 (Validity) | 0.0435 | 4.35% | ⚠️ 极低 |
| 2. 唯一性 (Uniqueness) | 1.0000 | 100% | ✅ 完美 |
| 3. 新颖性 (Novelty) | 1.0000 | 100% | ✅ 完美 |
| 4. BLEU分数 | 0.1028 | 10.28% | ❌ 很低 |
| 5. 精确匹配 (Exact Match) | 0.0000 | 0% | ❌ 无匹配 |
| 6. 编辑距离 (Levenshtein) | 0.9735 | 97.35% | ❌ 差异很大 |
| 7. MACCS指纹相似度 | 0.0601 | 6.01% | ❌ 很低 |
| 8. Morgan指纹相似度 | 0.0274 | 2.74% | ❌ 极低 |
| 9. RDKit指纹相似度 | 0.0034 | 0.34% | ❌ 极低 |
| 10. FCD分数 | 317.27 | - | ❌ 很高(越低越好) |

## 🔍 生成示例分析

### 示例1: 酮己糖单磷酸分子
- **输入SMILES**: `CC(=O)[C@@H](O)[C@H](O)C(=O)COP(=O)(O)O`
- **生成结果**: `Acum Bosch Montessoricurated Herz Richter...` (无效文本)
- **问题**: 生成的是随机文本而非SMILES

### 示例2: 芳香酮分子  
- **输入SMILES**: `CCCNCC(O)COc1ccccc1C(=O)CCc1ccccc1`
- **生成结果**: `ICC nesttri NestPO Montessori Martha...` (包含ICC但主要是文本)
- **问题**: 虽被判定为"有效"，但实际是文本而非真正的SMILES

## ⚠️ 关键问题

### 1. **模型输出问题**
- 模型生成的是文本词汇而非SMILES标记
- 输出包含人名、地名等与化学无关的词汇
- 表明解码器配置或训练存在严重问题

### 2. **有效性极低 (4.35%)**
- 100个样本中仅约4个生成了可被RDKit解析的SMILES
- 实际上这些"有效"的可能只是偶然包含了简单的化学片段

### 3. **模态转换失败**
- Graph和Image输入模态完全失败
- 错误信息显示数据类型不匹配问题

### 4. **缺少输出解码器**
- 6种组合因缺少Graph/Image解码器无法测试
- 当前系统只支持SMILES输出

## 💡 改进建议

### 紧急修复
1. **检查MolT5解码配置**
   - 确认使用正确的tokenizer
   - 验证词汇表是否为SMILES专用
   - 检查解码时是否使用了正确的token映射

2. **修复模态转换**
   - 解决Graph编码器的数据类型问题
   - 修复Image编码器的tensor处理

### 中期改进
1. **重新训练模型**
   - 使用正确的MolT5配置
   - 确保训练时使用SMILES tokenizer
   - 增加训练轮数和数据量

2. **实现缺失的解码器**
   - 添加Graph解码器
   - 添加Image解码器
   - 完成所有9种组合

### 长期优化
1. **提升生成质量**
   - 目标: 有效性>90%
   - 目标: 精确匹配>30%
   - 目标: 指纹相似度>70%

2. **扩展评估**
   - 增加更多评估指标
   - 使用更大的测试集
   - 进行人工评估

## 📋 结论

当前模型存在严重的生成问题，主要表现为:
1. **输出类型错误**: 生成文本而非SMILES
2. **有效性极低**: 仅4.35%的有效率无法满足实际应用
3. **功能不完整**: 9种组合中仅1种可测试

**建议**: 需要立即检查并修复MolT5解码器配置，确保模型能够生成有效的SMILES字符串。当前模型不适合用于实际的分子生成任务。

---

## 附录: 技术细节

### 训练配置
- 模型: molt5-base
- 训练轮数: 19 epochs
- 验证损失: 0.1443
- 批次大小: 16 (有效32，使用梯度累积)
- 学习率: 5e-5

### 测试环境
- GPU: 32GB显存
- 框架: PyTorch
- 测试数据: ChEBI-20数据集测试集

### 错误日志
- Graph错误: `'str' object has no attribute 'x'`
- Image错误: `Unsupported image type: <class 'torch.Tensor'>`
- Token错误: `piece id is out of range`